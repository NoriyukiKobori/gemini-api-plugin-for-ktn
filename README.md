# gemini-api-plugin-for-ktn

kintoneのフィールド値をもとにプロンプトを生成し、Gemini APIへリクエストを送信し、そのレスポンスをkintoneのフィールドに反映するプラグインです。

本リポジトリは **ソースコード公開用（開発者向け）** です。  
実際に利用可能なプラグインのパッケージ（zip）は、本リポジトリには含まれていません。

---

## このリポジトリについて

- 本リポジトリは **開発者向け** に公開しています
- プラグインを利用するには、ソースコードから **ビルド・パッケージングを行う必要があります**

---

## 概要

このプラグインでは、以下のことが可能です。

- kintoneのフィールドの値からプロンプトを生成
- Gemini APIへリクエストを送信
- AIの生成結果を指定したkintoneのフィールドへセットする
- kintone業務にAIを組み込むための基盤として利用可能

---

## 想定ユースケース

- 日報・議事録・報告書の要約
- 入力内容の整理・言い換え
- レビューコメントや文章案の生成
- kintone × 生成AIの検証

---

## 利用にあたっての注意

- 本プラグインは Gemini API を利用します
- APIキーの管理・利用料金については利用者自身の責任で行ってください
- 個人情報や機密情報をプロンプトに含めないよう注意してください

---

## 開発について

本プラグインは、作者が作成した  
**kintoneプラグイン開発テンプレート** を利用して実装されています。

以降の内容は、  
**本プラグインをビルド・改修・再配布したい開発者向け** の説明です。

---

## 開発テンプレートについて

### hazime-plugin-template-for-ktn

https://github.com/NoriyukiKobori/hazime-plugin-template-for-ktn

kintone プラグインの開発用テンプレートプロジェクトです。

#### 依存パッケージインストール

```bash
npm install
```

#### .gitignoreの編集

プラグインIDとパッケージファイルを管理するときは、.gitignoreのplugin-package/をコメントアウトして下さい

#### manifest.jsonの編集

manifest配下の以下のファイルをプロジェクト用に編集してください。

- manifest-dev.json（開発用プラグインのマニフェストファイル）
- manifest-pro.json（本番用プラグインのマニフェストファイル）
- manifest-svr.json（開発作業用プラグインのマニフェストファイル）

#### コーディング

src配下でコーディングします。

- main: メインのカスタマイズ用（デスクトップとモバイル共通）
- config: 設定画面用
- common: 共通関数など

**デスクトップ・モバイル対応について:**

このテンプレートでは、デスクトップとモバイルのカスタマイズファイル（JS/CSS）は共通のファイルを使用します。
デスクトップとモバイルで処理を切り分ける場合は、kintoneのイベント名を使って適宜分岐してください。

```typescript
// デスクトップ用イベント
kintone.events.on('app.record.detail.show', (event) => {
  // デスクトップのみの処理
});

// モバイル用イベント
kintone.events.on('mobile.app.record.detail.show', (event) => {
  // モバイルのみの処理
});

// デスクトップとモバイル両方に適用する場合
kintone.events.on(['app.record.detail.show', 'mobile.app.record.detail.show'], (event) => {
  // 共通処理
});
```

#### 環境ごとのビルド

ビルドコマンドを実行するとdist配下にビルドしたファイルを生成後、plugin-src配下にプラグインをパッケージするために構成をつくります。

- dev 環境（開発用、ソースマップあり）

```bash
npm run build:dev
```

- pro 環境（本番用、ソースマップなし）

```bash
npm run build:pro
```

- svr 環境（開発作業用、ソースマップあり）

```bash
npm run build:svr
```

#### ウォッチモード（svrモード専用）

**ウォッチモードはsvrモードでのみ使用できます。** devモードやproモードでは使用できません。

ファイルの変更を自動で検出してビルドし、plugin-src/svrに反映します。ローカルサーバーと組み合わせることで、コード変更が即座にkintoneに反映されます。

**注意:**

- ウォッチモードはJS/CSSファイルのみを監視します
- マニフェストファイル、アイコンファイル、config.htmlを変更した場合は、ウォッチモードを一旦終了し、ビルド・パッケージングを実行してください

```bash
npm run watch
```

**初回セットアップ手順:**

1. `npm run build:svr` でビルド
2. `npm run pack:svr` でプラグインをパッケージング
3. kintoneにプラグインをインストール
4. ローカルサーバー（Live Serverなど）を起動
5. `npm run watch` でウォッチモードを起動
6. 以降、TypeScript/SCSSファイルを編集すると自動でビルド・反映されます
7. 終了するには `Ctrl+C` を押してください

**マニフェストファイル、アイコンファイル、config.htmlを変更した場合:**

1. ウォッチモードを終了（`Ctrl+C`）
2. `npm run build:svr` でビルド
3. `npm run pack:svr` でパッケージング
4. kintoneでプラグインを再インストール
5. `npm run watch` でウォッチモード再開

#### 環境ごとのパッケージング

パッケージコマンドを実行すると、plugin-src配下のファイルをもとにプラグインのパッケージファイルを生成します。
plugin-package配下に生成されたzipファイルをkintoneに読み込ませてプラグインを適用させてください。

なお、svrモードでは、ローカルサーバーを起動しておくことで、一度kintoneにプラグインを読み込ませれば、毎回パッケージングをすることなく、変更したコードを適用することができます。

- dev 環境

```bash
npm run pack:dev
```

- pro 環境

```bash
npm run pack:pro
```

- svr 環境

```bash
npm run pack:svr
```

#### 免責事項

本ソフトウェアを利用したことにより生じたいかなる損害についても、作者は一切の責任を負いません。  
自己責任にてご利用ください。
